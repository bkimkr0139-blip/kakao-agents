# 📱 메신저 봇 R 설정 완벽 가이드

이 가이드를 따라하면 Android 스마트폰에서 메신저 봇 R 앱을 통해 카카오톡 메시지를 자동으로 3줄 요약하는 시스템을 구축할 수 있습니다.

## 🎯 목표

카카오톡으로 받는 메시지가 자동으로 → 서버로 전송 → AI가 3줄 요약 → 카카오톡으로 자동 답장

## 📋 필요한 것들

### 필수 요구사항
- ✅ Android 스마트폰 (Android 7.0 이상)
- ✅ 카카오톡 앱 설치
- ✅ 서버 실행 중 (이 프로젝트)
- ✅ 인터넷 연결

### 준비사항 체크리스트
- [ ] Android 스마트폰 준비
- [ ] 카카오톡 앱 최신 버전으로 업데이트
- [ ] 서버 IP 주소 확인 (`ipconfig` 명령어로 확인)
- [ ] 서버가 3000번 포트에서 실행 중인지 확인

---

## 📲 1단계: 메신저 봇 R 앱 설치

### 1.1 Google Play Store에서 앱 찾기

1. **스마트폰에서 Google Play Store 앱 열기**
2. **검색창에 "메신저 봇 R" 입력**
3. **개발자가 "XenomDev"인 앱을 찾기** (여러 비슷한 앱이 있을 수 있음)
4. **"설치" 버튼 터치**

![Google Play Store 검색 예시]
```
🔍 메신저 봇 R
📱 메신저 봇 R
⭐ 4.2 ★★★★☆
👤 XenomDev
📥 10만+ 다운로드
```

### 1.2 앱 설치 확인
- 설치가 완료되면 홈 화면에 **"메신저 봇 R"** 아이콘이 생성됩니다
- 아이콘을 터치해서 앱이 정상적으로 실행되는지 확인

---

## 🔐 2단계: 권한 설정 (매우 중요!)

메신저 봇 R이 카카오톡 알림을 읽고 처리하려면 특별한 권한이 필요합니다.

### 2.1 메신저 봇 R 앱 첫 실행

1. **메신저 봇 R 앱 실행**
2. **첫 실행시 권한 요청 팝업이 나타남**
3. **모든 권한 요청에 "허용" 터치**

### 2.2 알림 액세스 권한 설정 (핵심!)

#### 방법 1: 앱에서 직접 설정
1. **메신저 봇 R 앱 내에서 "권한 설정" 또는 "알림 액세스" 메뉴 찾기**
2. **"알림 액세스 권한" 터치**
3. **"메신저 봇 R" 앱 찾아서 토글 ON**

#### 방법 2: 안드로이드 설정에서 직접 설정
1. **스마트폰 설정 앱 열기**
2. **"앱 및 알림" 또는 "애플리케이션" 메뉴 진입**
3. **"특별 액세스" 또는 "고급" 메뉴 찾기**
4. **"알림 액세스" 또는 "알림 사용 권한" 선택**
5. **메신저 봇 R 찾아서 토글 ON**

> ⚠️ **중요**: 이 권한이 없으면 메신저 봇 R이 카카오톡 메시지를 읽을 수 없습니다!

### 2.3 기타 권한 설정
- **저장소 권한**: 허용
- **네트워크 권한**: 허용 (자동으로 설정됨)
- **백그라운드 실행 권한**: 허용

---

## ⚙️ 3단계: 메신저 봇 R 기본 설정

### 3.1 앱 실행 및 기본 설정

1. **메신저 봇 R 앱 실행**
2. **메인 화면에서 "설정" 또는 "Settings" 메뉴 터치**

### 3.2 카카오톡 감지 활성화

1. **"카카오톡" 또는 "KakaoTalk" 메뉴 찾기**
2. **"카카오톡 감지" 토글을 ON으로 설정**
3. **"알림 감지" 또는 "Notification Detection"을 활성화**

### 3.3 응답 모드 설정

1. **"응답 모드" 또는 "Reply Mode" 메뉴 찾기**
2. **"자동 응답" 또는 "Auto Reply" 선택**
3. **"웹훅 모드" 또는 "Webhook Mode" 활성화**

---

## 🌐 4단계: 서버 IP 주소 확인

웹훅 URL을 설정하기 전에 서버의 IP 주소를 확인해야 합니다.

### 4.1 Windows에서 IP 주소 확인

1. **Windows + R 키 동시 누르기**
2. **"cmd" 입력 후 Enter**
3. **명령 프롬프트에서 `ipconfig` 입력 후 Enter**
4. **"IPv4 주소" 확인 (예: 192.168.1.100)**

```cmd
Windows IP 구성

이더넷 어댑터 이더넷:
   연결별 DNS 접미사. . . . :
   IPv4 주소 . . . . . . . . : 192.168.1.100  ← 이 숫자 기억!
   서브넷 마스크 . . . . . . : 255.255.255.0
   기본 게이트웨이 . . . . . : 192.168.1.1
```

### 4.2 서버 실행 확인

1. **서버가 실행되고 있는지 확인**
   ```bash
   npm start
   ```
   
2. **브라우저에서 서버 접속 테스트**
   ```
   http://192.168.1.100:3000/health
   ```

3. **정상 응답 예시**:
   ```json
   {
     "status": "OK",
     "service": "KakaoTalk Business Agent",
     "timestamp": "2025-09-26T15:35:10.000Z"
   }
   ```

---

## 🔗 5단계: 웹훅 URL 설정 (핵심!)

### 5.1 메신저 봇 R에서 웹훅 설정

1. **메신저 봇 R 앱에서 "웹훅" 또는 "Webhook" 메뉴 찾기**
2. **"웹훅 URL" 또는 "Webhook URL" 입력란 찾기**
3. **다음 URL 형식으로 입력**:
   ```
   http://192.168.1.100:3000/webhook/messenger-bot-r/message
   ```
   > ⚠️ **중요**: `192.168.1.100`을 실제 서버 IP 주소로 바꿔주세요!

### 5.2 HTTP 메소드 설정
- **Method**: `POST` 선택
- **Content-Type**: `application/json` 선택

### 5.3 헤더 설정 (필요한 경우)
일부 메신저 봇 R 버전에서는 헤더 설정이 필요할 수 있습니다:
```
Content-Type: application/json
Accept: application/json
```

---

## 📝 6단계: JSON 페이로드 설정

메신저 봇 R에서 서버로 보낼 데이터 형식을 설정해야 합니다.

### 6.1 JSON 형식 설정 메뉴 찾기
1. **메신저 봇 R 앱에서 "페이로드" 또는 "Payload" 메뉴**
2. **"JSON 형식" 또는 "JSON Format" 선택**

### 6.2 JSON 템플릿 입력
다음 JSON 형식을 정확히 입력하세요:

```json
{
  "room": "{room}",
  "sender": "{sender}",
  "message": "{message}",
  "isGroupChat": {isGroupChat},
  "timestamp": {timestamp},
  "packageName": "com.kakao.talk"
}
```

### 6.3 변수 설명
- `{room}`: 카카오톡 채팅방 이름
- `{sender}`: 메시지 보낸 사람 이름
- `{message}`: 실제 메시지 내용
- `{isGroupChat}`: 그룹 채팅 여부 (true/false)
- `{timestamp}`: 메시지 받은 시간
- `{packageName}`: 앱 패키지 이름 (카카오톡)

---

## 🧪 7단계: 연결 테스트

### 7.1 서버 측에서 테스트

1. **PowerShell 또는 명령 프롬프트 열기**
2. **테스트 명령어 실행**:
   ```powershell
   Invoke-RestMethod -Uri "http://192.168.1.100:3000/webhook/messenger-bot-r/test" -Method Post -ContentType "application/json" -Body '{"message": "테스트 메시지입니다"}'
   ```

3. **정상 응답 예시**:
   ```json
   {
     "status": "success",
     "message": "웹훅 테스트 완료",
     "data": {
       "test_input": {...},
       "test_output": {...}
     }
   }
   ```

### 7.2 메신저 봇 R에서 테스트

1. **메신저 봇 R 앱에서 "테스트" 버튼 찾기**
2. **"웹훅 테스트" 또는 "Test Webhook" 터치**
3. **응답 확인**: 성공시 "200 OK" 또는 성공 메시지 표시

### 7.3 실제 카카오톡 테스트

1. **다른 사람에게 카카오톡 메시지 요청** (또는 다른 계정 사용)
2. **메시지를 받으면 자동으로 서버에 전송되는지 확인**
3. **서버 로그에서 메시지 처리 확인**:
   ```
   📱 메신저 봇 R 메시지 수신 - 방: 친구와의 채팅, 발신자: 홍길동
   ✅ 메신저 봇 R 응답 전송 - 처리시간: 3.2초
   ```

---

## 🔧 8단계: 고급 설정 및 최적화

### 8.1 응답 지연 설정
1. **메신저 봇 R에서 "응답 지연" 설정**
2. **2-5초 지연 설정** (서버 처리 시간 고려)

### 8.2 필터링 설정
1. **특정 채팅방만 처리**:
   - "필터링" 메뉴에서 처리할 채팅방 선택
2. **그룹 채팅 제외**:
   - "그룹 채팅 제외" 옵션 활성화 (원하는 경우)

### 8.3 백그라운드 실행 보장
1. **Android 설정 → 배터리 → 앱 최적화**
2. **메신저 봇 R를 "최적화하지 않음"으로 설정**
3. **자동 시작 관리자에서 메신저 봇 R 활성화**

---

## ⚠️ 9단계: 문제 해결

### 9.1 자주 발생하는 문제

#### 문제 1: "연결 실패" 오류
```
❌ Connection Failed
❌ HTTP 404 Not Found
```

**해결 방법**:
1. 서버 IP 주소 다시 확인
2. 서버가 실행 중인지 확인
3. 방화벽 설정 확인
4. URL에 오타가 없는지 확인

#### 문제 2: "권한 없음" 오류
```
❌ Permission Denied
❌ Notification Access Required
```

**해결 방법**:
1. 2단계 알림 액세스 권한 다시 설정
2. 메신저 봇 R 앱 재실행
3. 카카오톡 알림 허용 확인

#### 문제 3: 메시지가 전송되지 않음
```
✅ 서버는 정상
❌ 메시지가 서버로 안 옴
```

**해결 방법**:
1. 카카오톡 알림이 정상적으로 오는지 확인
2. 메신저 봇 R의 카카오톡 감지 설정 재확인
3. JSON 페이로드 형식 재검토

### 9.2 로그 확인 방법

#### 서버 로그 확인
1. **서버 실행 터미널에서 로그 확인**
2. **또는 관리자 대시보드에서 로그 조회**:
   ```
   http://192.168.1.100:3000/admin
   ```

#### 메신저 봇 R 로그 확인
1. **앱 내 "로그" 또는 "Log" 메뉴**
2. **최근 전송 기록 확인**
3. **오류 메시지 확인**

---

## 🎉 10단계: 최종 테스트 및 완료

### 10.1 전체 시스템 테스트

1. **친구나 가족에게 카카오톡 메시지 요청**
2. **메시지를 받으면**:
   ```
   원본: "안녕! 오늘 날씨가 정말 좋네. 같이 산책할래?"
   
   자동 응답: "📝 메시지 요약:
   안녕하세요!
   오늘 날씨가 좋다고 하네요.
   같이 산책하자는 제안입니다."
   ```

### 10.2 성능 확인

- **평균 응답 시간**: 3-5초
- **요약 품질**: 3줄 한국어 요약
- **안정성**: 24시간 연속 작동

### 10.3 설정 완료 체크리스트

- [ ] 메신저 봇 R 앱 설치 완료
- [ ] 알림 액세스 권한 허용 완료
- [ ] 웹훅 URL 설정 완료 (`http://IP:3000/webhook/messenger-bot-r/message`)
- [ ] JSON 페이로드 형식 설정 완료
- [ ] 서버 연결 테스트 성공
- [ ] 실제 카카오톡 메시지 테스트 성공
- [ ] 3줄 요약 응답 확인 완료

---

## 📞 추가 지원

### 관리자 대시보드
- **접속**: `http://192.168.1.100:3000/admin`
- **기능**: 실시간 테스트, 설정 변경, 로그 확인

### 문제 발생시
1. **서버 로그 확인**
2. **메신저 봇 R 앱 로그 확인** 
3. **관리자 대시보드에서 테스트**
4. **GitHub Issues에 문의**: https://github.com/bkimkr0139-blip/kakao-agents/issues

---

## 🏁 축하합니다!

이제 카카오톡으로 받는 모든 메시지가 자동으로 AI가 3줄로 요약해서 답장해주는 시스템이 완성되었습니다! 🎯🤖

**즐거운 AI 채팅 되세요!** 😊